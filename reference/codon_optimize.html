<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimize codon usage in coding sequences — codon_optimize • cubar</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimize codon usage in coding sequences — codon_optimize"><meta name="description" content="codon_optimize redesigns a coding sequence by replacing each codon
with its optimal synonymous alternative, while maintaining the same amino
acid sequence. This function supports multiple optimization methods and is
useful for improving protein expression in heterologous systems."><meta property="og:description" content="codon_optimize redesigns a coding sequence by replacing each codon
with its optimal synonymous alternative, while maintaining the same amino
acid sequence. This function supports multiple optimization methods and is
useful for improving protein expression in heterologous systems."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cubar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/cubar.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/codon_optimization.html">Codon optimization</a></li>
    <li><a class="dropdown-item" href="../articles/non_standard_genetic_code.html">Non-standard genetic code</a></li>
    <li><a class="dropdown-item" href="../articles/theory.html">Theories behind cubar</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mt1022/cubar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Optimize codon usage in coding sequences</h1>
      <small class="dont-index">Source: <a href="https://github.com/mt1022/cubar/blob/main/R/utils.R" class="external-link"><code>R/utils.R</code></a></small>
      <div class="d-none name"><code>codon_optimize.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>codon_optimize</code> redesigns a coding sequence by replacing each codon
with its optimal synonymous alternative, while maintaining the same amino
acid sequence. This function supports multiple optimization methods and is
useful for improving protein expression in heterologous systems.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">codon_optimize</span><span class="op">(</span></span>
<span>  <span class="va">seq</span>,</span>
<span>  optimal_codons <span class="op">=</span> <span class="va">optimal_codons</span>,</span>
<span>  cf <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  codon_table <span class="op">=</span> <span class="fu"><a href="get_codon_table.html">get_codon_table</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  level <span class="op">=</span> <span class="st">"subfam"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"naive"</span>,</span>
<span>  num_sequences <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  organism <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  envname <span class="op">=</span> <span class="st">"cubar_env"</span>,</span>
<span>  attention_type <span class="op">=</span> <span class="st">"original_full"</span>,</span>
<span>  deterministic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  temperature <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  top_p <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  match_protein <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  spliceai <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-seq">seq<a class="anchor" aria-label="anchor" href="#arg-seq"></a></dt>
<dd><p>A coding sequence as a DNAString object or any object that can
be coerced to DNAString. The sequence should not include stop codons.</p></dd>


<dt id="arg-optimal-codons">optimal_codons<a class="anchor" aria-label="anchor" href="#arg-optimal-codons"></a></dt>
<dd><p>A table of optimal codons as generated by
<code><a href="est_optimal_codons.html">est_optimal_codons()</a></code>, containing optimality information for each codon.</p></dd>


<dt id="arg-cf">cf<a class="anchor" aria-label="anchor" href="#arg-cf"></a></dt>
<dd><p>Matrix of codon frequencies from <code><a href="count_codons.html">count_codons()</a></code>. Required
for "IDT" method to determine codon frequency distributions.</p></dd>


<dt id="arg-codon-table">codon_table<a class="anchor" aria-label="anchor" href="#arg-codon-table"></a></dt>
<dd><p>A codon table defining the genetic code, derived from
<code><a href="get_codon_table.html">get_codon_table()</a></code> or <code><a href="create_codon_table.html">create_codon_table()</a></code>.</p></dd>


<dt id="arg-level">level<a class="anchor" aria-label="anchor" href="#arg-level"></a></dt>
<dd><p>Character string specifying optimization level: "subfam" (default,
within codon subfamilies) or "amino_acid" (within amino acid groups).
Required for "naive" and "IDT" methods.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character string specifying the optimization algorithm:</p><ul><li><p><code>"naive"</code> (default): Simple replacement with optimal codons</p></li>
<li><p><code>"IDT"</code>: Method from Integrated DNA Technologies tool</p></li>
<li><p><code>"CodonTransformer"</code>: Neural network-based optimization</p></li>
</ul></dd>


<dt id="arg-num-sequences">num_sequences<a class="anchor" aria-label="anchor" href="#arg-num-sequences"></a></dt>
<dd><p>Integer. Number of different optimized sequences to
generate (default: 1). For "CodonTransformer" with deterministic=FALSE,
each sequence is independently sampled.</p></dd>


<dt id="arg-organism">organism<a class="anchor" aria-label="anchor" href="#arg-organism"></a></dt>
<dd><p>Organism identifier (integer ID or string name) for
"CodonTransformer" method. Must be from ORGANISM2ID in CodonUtils
(e.g., "Escherichia coli general").</p></dd>


<dt id="arg-envname">envname<a class="anchor" aria-label="anchor" href="#arg-envname"></a></dt>
<dd><p>Environment name for "CodonTransformer" method. Should match
your conda environment name (default: "cubar_env").</p></dd>


<dt id="arg-attention-type">attention_type<a class="anchor" aria-label="anchor" href="#arg-attention-type"></a></dt>
<dd><p>Attention mechanism type for "CodonTransformer":</p><ul><li><p><code>"original_full"</code> (default): Standard attention</p></li>
<li><p><code>"block_sparse"</code>: Memory-efficient sparse attention</p></li>
</ul></dd>


<dt id="arg-deterministic">deterministic<a class="anchor" aria-label="anchor" href="#arg-deterministic"></a></dt>
<dd><p>Logical. For "CodonTransformer" method:</p><ul><li><p><code>TRUE</code> (default): Deterministic decoding (most likely tokens)</p></li>
<li><p><code>FALSE</code>: Probabilistic sampling based on temperature</p></li>
</ul></dd>


<dt id="arg-temperature">temperature<a class="anchor" aria-label="anchor" href="#arg-temperature"></a></dt>
<dd><p>Numeric. Controls randomness in non-deterministic mode
for "CodonTransformer". Lower values (0.2, default) are conservative;
higher values (0.8) increase diversity. Must be positive.</p></dd>


<dt id="arg-top-p">top_p<a class="anchor" aria-label="anchor" href="#arg-top-p"></a></dt>
<dd><p>Numeric. Nucleus sampling threshold (0-1) for "CodonTransformer".
Only tokens with cumulative probability up to this value are considered.
Default: 0.95.</p></dd>


<dt id="arg-match-protein">match_protein<a class="anchor" aria-label="anchor" href="#arg-match-protein"></a></dt>
<dd><p>Logical. For "CodonTransformer", constrains predictions
to maintain exact amino acid sequence. Recommended for unusual proteins
or high temperature settings (default: FALSE).</p></dd>


<dt id="arg-spliceai">spliceai<a class="anchor" aria-label="anchor" href="#arg-spliceai"></a></dt>
<dd><p>Logical. Whether to predict splice sites using SpliceAI
(default: FALSE). Requires appropriate environment setup.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The return type depends on parameters:</p><ul><li><p>Single DNAString: When num_sequences=1 and spliceai=FALSE</p></li>
<li><p>DNAStringSet: When num_sequences&gt;1 and spliceai=FALSE</p></li>
<li><p>data.table: When spliceai=TRUE (includes sequences and splice predictions)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Fallahpour A, Gureghian V, Filion GJ, Lindner AB, Pandi A. CodonTransformer:
a multispecies codon optimizer using context-aware neural networks. Nat Commun. 2025 Apr 3;16(1):3205.</p>
<p>Jaganathan K, Panagiotopoulou S K, McRae J F, et al. Predicting splicing from primary sequence
 with deep learning. Cell, 2019, 176(3): 535-548.e24.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">cf_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="count_codons.html">count_codons</a></span><span class="op">(</span><span class="va">yeast_cds</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">optimal_codons</span> <span class="op">&lt;-</span> <span class="fu"><a href="est_optimal_codons.html">est_optimal_codons</a></span><span class="op">(</span><span class="va">cf_all</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">seq</span> <span class="op">&lt;-</span> <span class="st">'ATGCTACGA'</span></span></span>
<span class="r-in"><span><span class="co"># method "naive":</span></span></span>
<span class="r-in"><span><span class="fu">codon_optimize</span><span class="op">(</span><span class="va">seq</span>, <span class="va">optimal_codons</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9-letter DNAString object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> seq: <span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #FFD7AF;">T</span></span>
<span class="r-in"><span><span class="co"># method "IDT":</span></span></span>
<span class="r-in"><span><span class="fu">codon_optimize</span><span class="op">(</span><span class="va">seq</span>, cf <span class="op">=</span> <span class="va">cf_all</span>, method <span class="op">=</span> <span class="st">"IDT"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9-letter DNAString object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> seq: <span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #FFD7AF;">T</span></span>
<span class="r-in"><span><span class="fu">codon_optimize</span><span class="op">(</span><span class="va">seq</span>, cf <span class="op">=</span> <span class="va">cf_all</span>, method <span class="op">=</span> <span class="st">"IDT"</span>, num_sequences <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DNAStringSet object of length 8:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     width seq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]     9 <span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #FFD7AF;">TT</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #FFD7AF;">T</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2]     9 <span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #FFD7AF;">T</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3]     9 <span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4]     9 <span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #AFFFFF;">GG</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5]     9 <span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #FFAFAF;">A</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6]     9 <span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #FFD7AF;">T</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7]     9 <span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #FFD7AF;">TT</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8]     9 <span style="color: #000000; background-color: #FFAFAF;">A</span><span style="color: #000000; background-color: #FFD7AF;">T</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #FFD7AF;">TT</span><span style="color: #000000; background-color: #AFFFAF;">C</span><span style="color: #000000; background-color: #AFFFFF;">G</span><span style="color: #000000; background-color: #FFAFAF;">A</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># # The following examples requires pre-installation of python package SpliceAI or Codon</span></span></span>
<span class="r-in"><span><span class="co">#  # Transformer. see the codon optimization vignette for further details.</span></span></span>
<span class="r-in"><span><span class="co"># seq_opt &lt;- codon_optimize(seq, method = "CodonTransformer",</span></span></span>
<span class="r-in"><span><span class="co">#     organism = "Saccharomyces cerevisiae")</span></span></span>
<span class="r-in"><span><span class="co"># seqs_opt &lt;- codon_optimize(seq, method = "CodonTransformer",</span></span></span>
<span class="r-in"><span><span class="co">#     organism = "Saccharomyces cerevisiae", num_sequences = 10,</span></span></span>
<span class="r-in"><span><span class="co">#     deterministic =FALSE, temperature = 0.4)</span></span></span>
<span class="r-in"><span><span class="co"># seqs_opt &lt;- codon_optimize(seq, cf = cf_all, method = "IDT",</span></span></span>
<span class="r-in"><span><span class="co">#     num_sequences = 10, spliceai = TRUE)</span></span></span>
<span class="r-in"><span><span class="co"># seq_opt &lt;- codon_optimize(seq, method = "CodonTransformer",</span></span></span>
<span class="r-in"><span><span class="co">#     organism = "Saccharomyces cerevisiae", spliceai = TRUE)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hong Zhang, Mengyue Liu, Bu Zi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

